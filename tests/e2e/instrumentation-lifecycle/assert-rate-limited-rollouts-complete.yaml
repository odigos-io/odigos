# Rate Limited Rollouts Complete Assertions
# Verifies that all deployments have completed their rollouts after rate-limited re-instrumentation (revision 4)
# Also verifies the InstrumentationConfig WorkloadRollout condition shows success

apiVersion: apps/v1
kind: Deployment
metadata:
  name: nodejs-minimum-version
  namespace: default
  annotations:
    deployment.kubernetes.io/revision: "4"
status:
  replicas: 1
  updatedReplicas: 1
  readyReplicas: 1
  availableReplicas: 1
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nodejs-latest-version
  namespace: default
  annotations:
    deployment.kubernetes.io/revision: "4"
status:
  replicas: 1
  updatedReplicas: 1
  readyReplicas: 1
  availableReplicas: 1
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: java-supported-version
  namespace: default
  annotations:
    deployment.kubernetes.io/revision: "4"
status:
  replicas: 1
  updatedReplicas: 1
  readyReplicas: 1
  availableReplicas: 1
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: python-latest-version
  namespace: default
  annotations:
    deployment.kubernetes.io/revision: "4"
status:
  replicas: 1
  updatedReplicas: 1
  readyReplicas: 1
  availableReplicas: 1
---
apiVersion: odigos.io/v1alpha1
kind: InstrumentationConfig
metadata:
  name: deployment-nodejs-minimum-version
  namespace: default
status:
  conditions:
    - type: WorkloadRollout
      status: "True"
      reason: RolloutTriggeredSuccessfully
---
apiVersion: odigos.io/v1alpha1
kind: InstrumentationConfig
metadata:
  name: deployment-nodejs-latest-version
  namespace: default
status:
  conditions:
    - type: WorkloadRollout
      status: "True"
      reason: RolloutTriggeredSuccessfully
---
apiVersion: odigos.io/v1alpha1
kind: InstrumentationConfig
metadata:
  name: deployment-java-supported-version
  namespace: default
status:
  conditions:
    - type: WorkloadRollout
      status: "True"
      reason: RolloutTriggeredSuccessfully
---
apiVersion: odigos.io/v1alpha1
kind: InstrumentationConfig
metadata:
  name: deployment-python-latest-version
  namespace: default
status:
  conditions:
    - type: WorkloadRollout
      status: "True"
      reason: RolloutTriggeredSuccessfully
