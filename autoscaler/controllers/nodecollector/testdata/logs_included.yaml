exporters:
  loadbalancing/traces:
    protocol:
      otlp:
        compression: none
        tls:
          insecure: true
    resolver:
      k8s:
        service: odigos-gateway.odigos-system
  otlp/odigos-own-telemetry-ui:
    endpoint: ui.odigos-system:4317
    retry_on_failure:
      enabled: false
    tls:
      insecure: true
  otlp/out-cluster-collector-logs:
    balancer_name: round_robin
    compression: none
    endpoint: dns:///odigos-gateway.odigos-system:4317
    tls:
      insecure: true
  otlp/out-cluster-collector-metrics:
    balancer_name: round_robin
    compression: none
    endpoint: dns:///odigos-gateway.odigos-system:4317
    tls:
      insecure: true
  otlp/out-cluster-collector-traces:
    balancer_name: round_robin
    compression: none
    endpoint: dns:///odigos-gateway.odigos-system:4317
    tls:
      insecure: true
extensions:
  health_check:
    endpoint: 0.0.0.0:13133
  pprof:
    endpoint: 0.0.0.0:1777
processors:
  batch: {}
  memory_limiter:
    check_interval: 500ms
    limit_mib: 0
    spike_limit_mib: 0
  odigostrafficmetrics:
    res_attributes_keys:
    - service.name
    - k8s.namespace.name
    - k8s.deployment.name
    - k8s.statefulset.name
    - k8s.daemonset.name
    - k8s.cronjob.name
    - k8s.argoproj.rollout.name
    - odigos.workload.kind
  resource/node-name:
    attributes:
    - action: upsert
      key: k8s.node.name
      value: ${NODE_NAME}
  resource/pod-name:
    attributes:
    - action: upsert
      key: k8s.pod.name
      value: ${POD_NAME}
  resourcedetection:
    detectors:
    - ec2
    - eks
    - azure
    - aks
    timeout: 2s
  test_type/test_processor:
    key: val
receivers:
  filelog:
    exclude:
    - /var/log/pods/kube-system_*/**/*
    - /var/log/pods/odigos-system_*/**/*
    include:
    - /var/log/pods/default_test-deployment-*_*/*/*.log
    - /var/log/pods/default_test-daemonset-*_*/*/*.log
    - /var/log/pods/other-namespace_test-statefulset-*_*/*/*.log
    include_file_name: false
    include_file_path: true
    operators:
    - id: container-parser
      type: container
    retry_on_failure:
      enabled: true
    start_at: end
  hostmetrics:
    collection_interval: 33s
    root_path: /hostfs
    scrapers:
      cpu:
        metrics:
          system.cpu.utilization:
            enabled: true
      disk: {}
      filesystem:
        exclude_mount_points:
          match_type: regexp
          mount_points:
          - /var/lib/kubelet/*
        metrics:
          system.filesystem.utilization:
            enabled: true
      load: {}
      memory: {}
      network: {}
      paging:
        metrics:
          system.paging.utilization:
            enabled: true
      processes: {}
  kubeletstats:
    auth_type: serviceAccount
    collection_interval: 44s
    endpoint: https://${env:NODE_IP}:10250
    insecure_skip_verify: true
  odigosebpf: {}
  otlp/in:
    protocols:
      grpc:
        drop_on_overload: true
        endpoint: 0.0.0.0:4317
      http:
        endpoint: 0.0.0.0:4318
  prometheus/self-metrics-ui:
    config:
      scrape_configs:
      - job_name: otelcol
        metric_relabel_configs:
        - action: keep
          regex: (.*odigos.*)
          source_labels:
          - __name__
        scrape_interval: 10s
        static_configs:
        - targets:
          - 127.0.0.1:55682
service:
  extensions:
  - health_check
  - pprof
  pipelines:
    logs:
      exporters:
      - otlp/out-cluster-collector-logs
      processors:
      - memory_limiter
      - resource/node-name
      - resourcedetection
      - test_type/test_processor
      - odigostrafficmetrics
      receivers:
      - filelog
    metrics:
      exporters:
      - otlp/out-cluster-collector-metrics
      processors:
      - batch
      - memory_limiter
      - resource/node-name
      - resourcedetection
      - test_type/test_processor
      - odigostrafficmetrics
      receivers:
      - otlp/in
      - odigosebpf
      - kubeletstats
      - hostmetrics
    metrics/own-metrics-ui:
      exporters:
      - otlp/odigos-own-telemetry-ui
      processors:
      - resource/pod-name
      receivers:
      - prometheus/self-metrics-ui
    traces:
      exporters:
      - loadbalancing/traces
      processors:
      - batch
      - memory_limiter
      - resource/node-name
      - resourcedetection
      - test_type/test_processor
      - odigostrafficmetrics
      receivers:
      - otlp/in
      - odigosebpf
  telemetry:
    metrics:
      level: detailed
      readers:
      - pull:
          exporter:
            prometheus:
              host: 0.0.0.0
              port: 55682
    resource:
      k8s.node.name: ${NODE_NAME}
      k8s.pod.name: ${POD_NAME}
      service.name: null
      service.version: null
