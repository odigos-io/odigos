---
title: "Odigos Components"
sidebarTitle: "Components"
---

## Goals

Odigos acts as a control plane for all the observability needs in a Kubernetes cluster. It is responsible for:

- Automatic instrumentation of applications
- Automatic configuration and deployment of collectors
- Infrastructure observability (Kubernetes nodes, databases, etc)

Odigos achieves its goals by deploying a set of components that work together to collect, process, and export telemetry data.

## High Level Architecture

<Frame>
    <img src="/images/odigos_architecture.png" alt="Odigos Architecture" />
</Frame>

### Component types:

- **Kubernetes Operators** - reconcile the desired state of cluster resources and deploy / configure the necessary components.
- **DaemonSets** - perform node-level tasks, such as interacting with a process running on the node OS, accessing the Kubelet, and reading logs from the node filesystem.
- **Deployments** - run cluster-level components like the OpenTelemetry Collector and the Odigos UI.

### Component Segments

Odigos is divided into three main segments:

- Instrumentation
  - Inject OpenTelemetry agents to collect the instrumentation data from Odigos sources (instrumented applications)
  - Record and report runtime information from the process environment that is relevant to instrumentation
  - Export collected telemetry to the pipeline.

- Pipeline
  - Offload common or heavy tasks from the instrumented application runtime
  - Apply Odigos Actions on the telemetry data
  - Batch and send the telemetry data to the configured destinations

- Odigos Management
  - orchestrate the pipeline and the instrumentation based on the user's configuration and cluster state,
  - provide a UI for the odigos control plane.

## Pipeline

### Auto Scaler (Pipeline Manager)

**Type**: Auto scaler is a Kubernetes operator

**K8s Resource**: `kubectl get deployments -n odigos-system odigos-autoscaler`

**Role**: The auto scaler component is responsible for managing the OpenTelemetry Collectors which implement the OpenTelemetry pipeline.

- Start and stop collectors when needed (e.g. when sources or destinations are added or removed).
- Schedule the node collector to start only after the cluster collector is ready.
- Generate the configuration for the collectors based on the Odigos sources, destinations, and action.

### Cluster Collector (Gateway Collector)

**Type**: Cluster collector is a deployment of the OpenTelemetry collector

**K8s Resource**: `kubectl get deployments -n odigos-system odigos-gateway`

**Role**: The cluster collector receives all the telemetry collected in the cluster, process it (to apply any actions), and export it to the configured destinations.

- Batch telemetry items for better performance, and export them reliably to the configured destinations (retries, backoff, etc).
- Modify the telemetry data based on the Odigos actions (add/remove/modify/rename attributes, etc).
- Apply tail sampling based on the Odigos Actions to reduce the volume of data sent to the destinations.
- Collect metrics about the entities and report it to the UI for monitoring.
- Offload tasks from the agents, to reduce the overhead on the workload runtime environment
- Centralize any common processing that can be shared across multiple agents.

### Node Collector

**Type**: The node collector is a daemon set and will run one pod per node in the cluster

**K8s Resource**: `kubectl get daemonsets -n odigos-system odigos-data-collection`

**Role**: The Node Collector (in the context of Pipeline component) receives telemetry data from agents running on the node, enriches it with node-level attributes, and forward it efficiently and reliably to the cluster collector.

- Receives the telemetry data collected from agents running on the node (odiglet for eBPF based agents, and instrumentation process for native OpenTelemetry agents).
- Add node-level attributes to the telemetry data (`k8s.node.name`, cloud attributes, etc).
- Batches and sends the telemetry data to the cluster collector, offloading any network overhead from the instrumented application runtime.

<Info>
The Node Collector is also responsible for recording some k8s metrics, and collecting the generated logs from the node fs. Read more Under the [Instrumentation](#node-collector-2) section.
</Info>

## Instrumentation

### Instrumentor (Auto Instrumentation Agent Manager)

**Type**: The instrumentor is a Kubernetes operator

**K8s Resource**: `kubectl get deployments -n odigos-system odigos-instrumentor`

**Role**: The instrumentor is responsible for managing the auto instrumentation agents which collect the telemetry data from the Odigos sources.

- Create and manage the `instrumentationconfig.odigos.io` objects
  - Triggers `odiglet` to inspect runtime information of the workload.
  - Triggers the scheduler to deploy the Odigos pipeline.
  - Merge the Odigos instrumentation rules and odigos config to a workload scope configuration to be used by the agent.
- Inject the instrumentation device into the workload manifest resource as virtual device.
- Monitor the `source.odigos.io` CRD and cleanup any instrumentation related resources when a source is removed.

### Odiglet

**Type**: Odiglet is a daemon set and will run one pod per node in the cluster

**K8s Resource**: `kubectl get daemonsets -n odigos-system odiglet`

**Role**: The odiglet component sets up the k8s node environment to run the telemetry-collection agents.

- Inspect the runtime details of the instrumented sources containers (programming language, relevant env variables, runtime versions, etc).
- Implement the Kubernetes virtual instrumentation devices. In the presence of a supported devices on the pod, odiglet will mount the agent code from fily-system to the pod, and add the relevant environment variables to initiate instrumentation.
- For eBPF based instrumentation, odiglet will inject the eBPF code into the pod, pick up the telemetry items from the eBPF queues and push it downstream to node collector component.
- Monitor changes to instrumentations config, and apply to the relevant agents accordingly at runtime.

### Node Collector

**Role**: Node collector (in the context of instrumentation) is responsible for scraping Kubernetes metrics, and collect logs from the node filesystem.

- When a destination for metrics exists, the node collector will use the OpenTelemetry-Collector ["kubeletstats receiver"](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/kubeletstatsreceiver) to scrape k8s related metrics from the kubelet and export them as otel metrics to the cluster collector.
- When a destination for logs exists, the node collector will use the OpenTelemetry-Collector ["filelog receiver"](https://github.com/open-telemetry/opentelemetry-collector-contrib/tree/main/receiver/filelogreceiver) to read the relevant pod logs from the node filesystem and export them as otel logs to the cluster collector.

## Odigos

### Odigos UI

**Type**: Odigos UI is a web application, it's backend is a deployment in the cluster, and the frontend runs in the user's browser.

**K8s Resource**: `kubectl get deployments -n odigos-system odigos-ui`

**Role**: The Odigos UI is a web application that allows users to configure various aspects of the Odigos installation.

- Serve as web server for the Odigos UI:
  - Serve static files to the frontend
  - Provide a GraphQL API for the frontend, which in turn interacts with Kubernetes API to manage the Odigos installation.
- Provide a user interface for monitoring and managing the Odigos installation, including the sources, destinations, actions, and instrumentation rules.
- Examine the current state of Odigos and show any errors.

### Scheduler

**Type**: Scheduler is a Kubernetes operator

**K8s Resource**: `kubectl get deployments -n odigos-system odigos-scheduler`

**Role**: The scheduler is responsible for managing the Odigos installation itself.

- Monitor the Odigos sources and destinations, to trigger the deployment of the Odigos pipeline.
- Reconcile odigos configuration to run validations, set defaults, and apply ODigos profiles (configuration presets) to the cluster.
