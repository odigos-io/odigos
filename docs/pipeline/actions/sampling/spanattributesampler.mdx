---
title: "Span Attribute Sampler"
description: "This action is an [Endpoint Action](/pipeline/actions/introduction#scope-categories) that samples traces based on the existence or value of specific span attributes."
sidebarTitle: "Span Attribute Sampler"
icon: "tag"
---

import BetaWarning from '/snippets/beta-warning.mdx';
import AssumeNoMeaning from '/snippets/assume-no-meaning.mdx';

<BetaWarning />

## Considerations

<Warning>
  Before enabling **span attribute sampler**, please note the following:
  - Supports only traces.
  - All spans in a trace will be either entirely dropped or entirely sampled.
  - Adding this action causes a 30-second delay in sending the data.
  - Traces with durations exceeding 30 seconds might not be sampled correctly.
</Warning>

## Use Cases

**Attribute-Based Debugging**

- Retain traces containing spans with certain attribute values, simplifying debugging for specific scenarios or features.

**Cost Optimization**

- Limit collection of trace data by focusing on specific, high-value attributes.

## Configuration Options

<AccordionGroup>
  <Accordion title="actionName">
    **actionName** `string` : Allows you to attach a meaningful name to the action for convenience.
    - This field is *optional*
    - <AssumeNoMeaning />
  </Accordion>
  <Accordion title="notes">
    **notes** `string` : Allows you to attach notes regarding the action for convenience.
    - This field is *optional*
    - <AssumeNoMeaning />
  </Accordion>
  <Accordion title="disabled">
    **disabled** `boolean` : Allows you to temporarily disable the action, but keep it saved for future use.
    - This field is *optional*, defaults to `false`
  </Accordion>
  <Accordion title="signals *">
    **signals** `string[]` : An array with the signals that the processor will act on.
    - This field is *required*
    - Supported values: `TRACES`
  </Accordion>
  <Accordion title="attribute_filters *">
    **attribute_filters** `object[]` : Specifies which span attributes should trigger trace sampling.
    - This field is *required*

    <AccordionGroup>
      <Accordion title="attribute_key *">
        **attribute_key** `string` : The name of the span attribute to check for existence or value.
        - This field is *required*
      </Accordion>
      <Accordion title="attribute_value">
        **attribute_value** `string` : The specific attribute value to match. If omitted, any span containing the attribute key will match.
        - This field is *optional*
      </Accordion>
    </AccordionGroup>
  </Accordion>
  <Accordion title="fallback_sampling_ratio *">
    **fallback_sampling_ratio** `number` : Percentage of traces not matching the attribute filters that will still be retained. Useful to maintain baseline visibility.
    - This field is *required*
  </Accordion>
</AccordionGroup>

<Info>
  Traces containing at least one span matching the attribute filters will always be retained. If no span matches, traces will be sampled according to the fallback ratio.
</Info>

## Basic Example

The following example retains all traces with spans containing an attribute `error` set to `true`. Additionally, it retains 10% of all other traces.

<Steps>
  <Step>
    Create a YAML file with the following content:

    ```yaml span-attribute-sampler.yaml
    apiVersion: actions.odigos.io/v1alpha1
    kind: SpanAttributeSampler
    metadata:
      name: example-spanattributesampler
      namespace: odigos-system
    spec:
      actionName: "example-spanattributesampler-action"
      attribute_filters:
      - attribute_key: "error"
        attribute_value: "true"
      fallback_sampling_ratio: 10
      signals:
      - TRACES
    ```
  </Step>
  <Step>
    Apply the action to the cluster:

    ```bash
    kubectl apply -f span-attribute-sampler.yaml
    ```
  </Step>
</Steps>
