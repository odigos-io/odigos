# RBAC Authorization

In this doc, we'll keep track of the permissions requested across different resources, organized by `APIGroups`, `Resources`, `Verbs`, and the `Component` requesting them. Each permission includes comments to explain its purpose.

## ClusterRole

| Component    | APIGroups         | Resources                                                  | Verbs                                           | Comments                                                                                                                  |
| ------------ | ----------------- | ---------------------------------------------------------- | ----------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------- |
| Odiglet      | ""                | pods                                                       | get, list, watch                                | Needed for language detection.                                                                                            |
| Odiglet      | ""                | pods/status                                                | get                                             | Needed for language detection.                                                                                            |
| Odiglet      | ""                | nodes                                                      | get, list, watch                                | Needed for virtual device registration.                                                                                   |
| Odiglet      | apps              | deployments, daemonsets, statefulsets                      | get, list, watch                                | Needed for language detection (temporary until new detection logic is ready).                                             |
| Odiglet      | apps              | deployments/status, daemonsets/status, statefulsets/status | get                                             | Needed for language detection (temporary until new detection logic is ready).                                             |
| Odiglet      | apps              | replicasets                                                | get                                             | Needed for language detection (temporary until new detection logic is ready).                                             |                                                                          |
| Odiglet      | odigos.io         | instrumentationinstances                                   | create, get, list, patch, update, watch, delete | Manages instrumentation instances for process state storage.                                                              |
| Odiglet      | odigos.io         | instrumentationinstances/status                            | get, patch, update                              | Updates status of instrumentation instances.                                                                              |
| Odiglet      | odigos.io         | instrumentationconfigs                                     | get, list, watch, patch, update                 | Manages instrumentation configurations (future update for runtime details storage).                                       |
| Odiglet      | odigos.io         | instrumentationconfigs/status                              | get, patch, update                              | Updates status of instrumentation configurations.                                                                         |
| Odiglet      | policy            | podsecuritypolicies                                        | use                                             | Allows using privileged PSP (if enabled).                                                                                 |
| Instrumentor | ""                | nodes, namespaces                                          | get, list, watch                                | Tracks runtime detection and resource labels for instrumentation.                                                         |
| Instrumentor | apps              | daemonsets, deployments, statefulsets                      | get, list, watch, update, patch                 | Adjusts pod specifications for instrumentation.                                                                           |
| Instrumentor | odigos.io         | instrumentedapplications                                   | delete, get, list, watch                        | Delete deprecated CR.                                                                                |                                                                           |
| Instrumentor | odigos.io         | instrumentationconfigs                                     | create, delete, get, list, patch, update, watch | Manages instrumentation configurations.                                                                                   |
| Scheduler    | odigos.io         | instrumentationconfigs                                     | get, list, watch                                | Monitors changes in instrumentation configurations for scheduling updates.                                                |
| Autoscaler   | odigos.io         | instrumentationconfigs                                     | get, list, watch                                | Reads instrumentation configurations to populate the `data-collector` configmaps.                                         |
| Collector    | ""                | nodes/stats, nodes/proxy                                   | get, list                                       | Retrieves metrics for telemetry purposes.                                                                                 |
| Collector    | ""                | pods                                                       | get, list                                       | Accesses metadata for resource name processors.                                                                           |
| Collector    | apps              | replicasets, deployments, daemonsets, statefulsets         | get, list                                       | Fetches application details for instrumentation.                                                                          |
| Collector    | ""                | endpoints                                                  | get, list, watch                                | Needed for load balancer.                                                                                                 |
| Collector    | policy            | podsecuritypolicies                                        | use                                             | Supports clients enabling pod security policies (optional).                                                               |
| UI           | ""                | namespaces                                                 | get, list, patch                                | Needed to retrieve and instrument namespaces.                                                                             |
| UI           | ""                | services                                                   | get, list                                       | Required for discovering potential destinations and describing application workloads.                                     |
| UI           | ""                | pods                                                       | get, list, watch                                | Required for discovering potential destinations and describing application workloads, and for updating collector metrics. |
| UI           | apps              | deployments, statefulsets, daemonsets                      | get, list, patch, update                        | Required for instrumentation of application sources.                                                                      |
| UI           | apps              | replicasets                                                | get, list                                       | Needed for describing application and resource relationships.                                                             |
| UI           | odigos.io         | instrumentationconfigs, instrumentationinstances           | get, list, watch                                | Monitors and retrieves configurations for instrumentation.                                                                |
| UI           | actions.odigos.io | \*                                                         | get, list, create, patch, update, delete        | Handles pipeline actions for custom logic.                                                                                |

---

## Role

| Component    | APIGroups         | Resources                                 | Verbs                                                             | Comments                                                                                     |
| ------------ | ----------------- | ----------------------------------------- | ----------------------------------------------------------------- | -------------------------------------------------------------------------------------------- |
| Odiglet      | odigos.io         | collectorsgroups, collectorsgroups/status | get, list, watch                                                  | Reads enabled signals for each source (temporary until migration to instrumentation config). |
| Odiglet      | ""                | configmaps                                | get, list, watch                                                  | Reads `odigos_config` for ignored containers.                                                |
| Instrumentor | ""                | configmaps                                | get, list, watch                                                  | Accesses `odigos-config` for instrumentation configuration.                                  |
| Instrumentor | odigos.io         | collectorsgroups                          | get, list, watch                                                  | Monitors collectors and their statuses.                                                      |
| Scheduler    | ""                | configmaps                                | get, list, watch                                                  | react and reconcile `odigos-config` changes to effective config.                                            |
| Scheduler    | ""                | configmaps                                | get, list, watch, patch                                                  | apply effective config after reconciling (defaulting and profile applying) and react to it                                            |
| Scheduler    | odigos.io         | collectorsgroups                          | get, list, create, patch, update, watch, delete                   | Manages `collectorsgroups`.                                                                  |
| Scheduler    | odigos.io         | destinations                              | get, list, watch                                                  | Tracks destinations for scheduling behavior.                                                 |
| Autoscaler   | ""                | configmaps, services                      | get, list, watch, create, patch, update, delete, deletecollection | Manages collector configurations and services.                                               |
| Autoscaler   | apps              | daemonsets, deployments                   | get, list, watch, create, patch, update, delete, deletecollection | Oversees collector deployments and readiness statuses.                                       |
| Autoscaler   | apps              | daemonsets/status, deployments/status     | get                                                               | Reads readiness statuses.                                                                    |
| Autoscaler   | autoscaling       | horizontalpodautoscalers                  | create, patch, update, delete                                     | Implements autoscaling for gateway collectors.                                               |
| Autoscaler   | odigos.io         | destinations                              | get, list, watch                                                  | Tracks and synchronizes destination configurations.                                          |
| Autoscaler   | odigos.io         | collectorsgroups, destinations/status     | get, patch, update                                                | Monitors and updates statuses of collectors groups and destinations.                         |
| UI           | ""                | configmaps                                | get, list                                                         | Reads `odigos-config` for UI configuration.                                                  |
| UI           | ""                | secrets                                   | get, list, create, patch, update                                  | Manages destination secrets for configurations.                                              |
| UI           | odigos.io         | instrumentationrules, destinations        | get, list, create, patch, update, delete                          | CRUD for destinations and instrumentation rules.                                             |
| UI           | odigos.io         | collectorsgroups                          | get, list                                                         | Monitors groupings of collectors for UI updates.                                             |
| UI           | actions.odigos.io | \*                                        | get, list, create, patch, update, delete                          | Pipeline action management.                                                                  |
