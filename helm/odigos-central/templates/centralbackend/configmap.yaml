{{- if (include "odigos.secretExists" .) }}
{{- $imageTag := .Values.image.tag | default .Chart.AppVersion }}

apiVersion: v1
kind: ConfigMap
metadata:
  name: odigos-central-deployment
  namespace: {{ .Release.Namespace }}
  labels:
    odigos.io/system-object: "true"
data:
  odigosVersion: {{ $imageTag | quote }}
  installationMethod: "helm"
  {{- $cm := lookup "v1" "ConfigMap" .Release.Namespace "odigos-central-deployment" }}
  {{- $existingID := "" }}
  {{- if $cm }}
    {{- $existingID = (index $cm.data "odigosCentralDeploymentID" | default "") }}
  {{- end }}
  odigosCentralDeploymentID: {{ default (randAlphaNum 16) $existingID | quote }}
{{- end }}


