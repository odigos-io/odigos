# Global image controls
# -- Override image tag for all Odigos components (empty = chart default)
image:
  tag: ''
# -- Prefix/registry for all Odigos images (empty = built-in defaults)
imagePrefix: ''
# -- Image pull secrets for private registries (k8s secret names)
imagePullSecrets: []

centralBackend:
  # Resources and scheduling for the Central backend
  # -- Maximum message size in bytes for gRPC messages (empty = use default)
  # maxMessageSize: ''
  # Gate central-backend startup on Keycloak readiness (initContainer).
  # Set enabled=false to allow central-backend to start without waiting for Keycloak.
  waitForKeycloak:
    enabled: true
    # -- Container image used for the wait loop (must include `sh` + `wget`)
    image: busybox:1.36.1
    # -- URL checked for Keycloak readiness (200/OK expected)
    url: http://keycloak:8080/realms/master
    # -- Max time to wait before failing the pod startup
    timeoutSeconds: 60
    # -- Poll interval between retries
    pollIntervalSeconds: 2
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  nodeSelector:
    kubernetes.io/os: linux
  tolerations: []
  affinity: []
  # HorizontalPodAutoscaler for the backend
  autoscaling:
    # -- Enable HPA for the backend
    enabled: true
    # -- HPA replica bounds
    minReplicas: 1
    maxReplicas: 10
    # -- Target average CPU utilization percentage
    cpuTargetUtilization: 70
    behavior:
      scaleUp:
        stabilizationWindowSeconds: 30
        selectPolicy: Max
        policies:
          percent:
            value: 100
            periodSeconds: 30
          pods:
            value: 2
            periodSeconds: 30
      scaleDown:
        stabilizationWindowSeconds: 600
        selectPolicy: Min
        policies:
          percent:
            value: 10
            periodSeconds: 60
          pods:
            value: 1
            periodSeconds: 60

centralUI:
  # Central UI settings
  uiMode: normal
  uiPaginationLimit: 0
  # -- Override backend URL (empty = in-cluster service)
  centralBackendURL: ''
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi
  nodeSelector:
    kubernetes.io/os: linux
  tolerations: []
  affinity: []

redis:
  image: redis:7.4.2
  port: 6379
  portName: redis
  # Set to ~85% of memory limit to leave headroom for Redis overhead
  # Current: 220mb = 85% of 256Mi limit. Adjust proportionally if changing memory limits.
  maxmemory: 220mb
  # Eviction policy when maxmemory is reached
  # allkeys-lru: evict least recently used keys (good default for mixed use)
  maxmemoryPolicy: allkeys-lru
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

auth:
  # Built-in Keycloak configuration
  enabled: true
  image: registry.odigos.io/keycloak:24.0.3
  adminUsername: admin
  # -- Keycloak admin password for internal API access.
  # On first install: uses this value, or auto-generates if empty.
  # On upgrades: ignores this value and reuses the existing password from the secret
  # to prevent mismatch with Keycloak's stored credentials.
  adminPassword: ''
  port: 8080
  portName: http
  # Ensure volume permissions are compatible when persistence is enabled
  podSecurityContext:
    enabled: true
    fsGroup: 1000
  securityContext:
    enabled: true
    runAsNonRoot: true
    allowPrivilegeEscalation: false

  # Persistence (disabled by default). Enable to keep Keycloak data via PVC.
  # ref: https://kubernetes.io/docs/concepts/storage/persistent-volumes/
  persistence:
    enabled: false
    size: 1Gi
    # -- PVC access modes
    # See: kubectl explain persistentvolumeclaim.spec.accessModes
    accessModes:
      - ReadWriteOnce
    # -- Storage class behavior:
    #    - Omit key to use the cluster default (if any)
    #    - Set to a class name to bind to that class
    storageClassName: ''
    # -- Use an existing PVC by name instead of creating one
    # If set, the chart will not create a PVC and will mount this claim
    existingClaim: ''

  resources:
    requests:
      cpu: 100m
      memory: 384Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Limits Keycloak's JVM memory to a small, efficient range suitable for medium traffic
  javaOpts: '-Xms128m -Xmx256m'

  # Liveness probe settings
  # Keycloak exposes /health/live for liveness checks
  livenessProbe:
    enabled: true
    initialDelaySeconds: 120
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
    port: 8080

  # Readiness probe settings
  # Keycloak exposes /health/ready for readiness checks
  readinessProbe:
    enabled: true
    initialDelaySeconds: 60
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
    successThreshold: 1
    port: 8080

  nodeSelector:
    kubernetes.io/os: linux
  tolerations: []
  affinity: []

# OpenShift-specific toggles (RBAC/SELinux/images)
openshift:
  enabled: false

# GKE-specific toggles (reserved)
gke:
  enabled: false

topologySpreadConstraints: []
