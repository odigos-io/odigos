---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  labels:
    odigos.io/system-object: "true"
  name: instrumentationconfigs.odigos.io
spec:
  group: odigos.io
  names:
    kind: InstrumentationConfig
    listKind: InstrumentationConfigList
    plural: instrumentationconfigs
    singular: instrumentationconfig
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: InstrumentationConfig is the Schema for the instrumentationconfig
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              Config for the OpenTelemeetry SDKs that should be applied to a workload.
              The workload is identified by the owner reference
            properties:
              agentInjectionEnabled:
                description: determines if odigos should inject agents to pods of
                  this workload.
                type: boolean
              agentsMetaHash:
                description: |-
                  this hash is used to determine the deployment of the agents.
                  e.g. when the distro for container changes, or it's compatibility version,
                  or something else that requires rollout, the hash change will indicate that.
                  if the hash is empty, it means that no agent should be enabled in any pod container.
                type: string
              agentsMetaHashChangedTime:
                description: |-
                  The last time at which the agents meta hash value was changed.
                  Pods created before this time may not be in alignment with the AgentsMetaHash.
                  e.g. can lack the odigos label, or have a different value.
                format: date-time
                type: string
              containerOverridesHash:
                description: |-
                  An hash of the containers overrides, used to determine if the overrides have changed for event filtering.
                  this is updated only when the overrides are changed, and not when some other change in the source occurs.
                type: string
              containers:
                description: configuration for each instrumented container in the
                  workload
                items:
                  description: ContainerAgentConfig is a configuration for a specific
                    container in a workload.
                  properties:
                    agentEnabled:
                      description: boolean flag to indicate if the agent should be
                        enabled for this container.
                      type: boolean
                    agentEnabledMessage:
                      description: |-
                        free text message to provide more information about the instrumentation decision.
                        can be left empty if reason is self-explanatory.
                      type: string
                    agentEnabledReason:
                      description: An enum reason for the agent injection decision.
                      enum:
                      - EnabledSuccessfully
                      - WaitingForRuntimeInspection
                      - WaitingForNodeCollector
                      - IgnoredContainer
                      - NoCollectedSignals
                      - InjectionConflict
                      - UnsupportedProgrammingLanguage
                      - NoAvailableAgent
                      - UnsupportedRuntimeVersion
                      - MissingDistroParameter
                      - OtherAgentDetected
                      - RuntimeDetailsUnavailable
                      - CrashLoopBackOff
                      - ImagePullBackOff
                      type: string
                    containerName:
                      description: The name of the container to which this configuration
                        applies.
                      type: string
                    distroParams:
                      additionalProperties:
                        type: string
                      description: |-
                        Additional parameters to the distro that controls how it's being applied.
                        Keys are parameter names (like "libc") and values are the value to use for that parameter (glibc / musl)
                      type: object
                    envInjectionMethod:
                      description: |-
                        What method to use for injecting the agent environment variables (just those covered by the loader (PYTHONPATH, JAVA_TOOLS_OPTIONS, NODE_OPTIONS))
                        Can be either "loader" or "pod-manifest".
                        The injection should still check the actual values in the container manifest before injecting.
                        Nil means that this container should not have env injection (agent should not be injected, or distro does not specify "loader" injection envs).
                      enum:
                      - loader
                      - pod-manifest
                      type: string
                    logs:
                      description: |-
                        all "logs" related configuration for an agent running on any process in a specific container.
                        The presence of this struct (as opposed to nil) means that logs collection is enabled for this container.
                      type: object
                    metrics:
                      description: |-
                        all "metrics" related configuration for an agent running on any process in a specific container.
                        The presence of this struct (as opposed to nil) means that metrics collection is enabled for this container.
                      properties:
                        runtimeMetrics:
                          description: |-
                            if not nil, it means agent should report runtime metrics,
                            such as JVM metrics for Java applications.
                            these metrics provide insights into the runtime environment performance.
                          properties:
                            java:
                              description: configuration for Java runtime metrics
                              properties:
                                disabled:
                                  description: global enable/disable for all Java
                                    runtime metrics
                                  type: boolean
                                metrics:
                                  description: individual metric configurations
                                  items:
                                    properties:
                                      disabled:
                                        description: whether this specific metric
                                          is disabled
                                        type: boolean
                                      name:
                                        description: name of the runtime metric (e.g.,
                                          "jvm.class.loaded")
                                        type: string
                                    required:
                                    - name
                                    type: object
                                  type: array
                              type: object
                          type: object
                        spanMetrics:
                          description: |-
                            if not nil, it means agent should report span metrics,
                            calculated directly in the agent.
                            this is most accurate as it includes any sampled spans,
                            and is not affected if spans are dropped anywhere in the pipeline.
                          properties:
                            dimensions:
                              description: |-
                                additional dimensions to add for the span metrics.
                                for example, if you add `http.method` to the dimensions,
                                then the span metrics data points will include the `http.method` in the attributes,
                                and different values of `http.method` will be aggregated into different time series.
                              items:
                                type: string
                              type: array
                            histogramBucketsMs:
                              description: explicit buckets list for the histogram
                                metrics in ms
                              items:
                                type: integer
                              type: array
                            intervalMs:
                              description: |-
                                time interval in miliseconds for flushing the span metrics.
                                defaults: 60000 (60 seconds, 1 minute)
                              type: integer
                          type: object
                      type: object
                    otelDistroName:
                      description: |-
                        The name of the otel distribution to use for this container.
                        if the name is empty, this container should not be instrumented.
                      type: string
                    podManifestInjectionOptional:
                      description: set to true if the agent used in this container
                        can be injected without pod manifest changes.
                      type: boolean
                    traces:
                      description: |-
                        Each enabled signal must be set with a non-nil value (even if the config content is empty).
                        nil means that the signal is disabled and should not be instrumented/collected by the agent.
                      properties:
                        headSampling:
                          description: |-
                            HeadSamplingConfig is a set sampling rules.
                            This config currently only applies to root spans.
                            In the Future we might add another level of configuration base on the parent span (ParentBased Sampling)
                          properties:
                            attributesAndSamplerRules:
                              items:
                                description: |-
                                  AttributesAndSamplerRule is a set of AttributeCondition that are ANDed together.
                                  If all attribute conditions evaluate to true, the AND sampler evaluates to true,
                                  and the fraction is used to determine the sampling decision.
                                  If any of the attribute compare samplers evaluate to false,
                                  the fraction is not used and the rule is skipped.
                                  An "empty" AttributesAndSamplerRule with no attribute conditions is considered to always evaluate to true.
                                  and the fraction is used to determine the sampling decision.
                                  This entity is refered to a rule in Odigos terminology for head-sampling.
                                properties:
                                  attributeConditions:
                                    items:
                                      description: '''Operand'' represents the attributes
                                        and values that an operator acts upon in an
                                        expression'
                                      properties:
                                        key:
                                          description: attribute key (e.g. "url.path")
                                          type: string
                                        operator:
                                          description: The operator to use to compare
                                            the attribute value.
                                          enum:
                                          - equals
                                          - notEquals
                                          - endWith
                                          - startWith
                                          type: string
                                        val:
                                          description: currently only string values
                                            are supported.
                                          type: string
                                      required:
                                      - key
                                      - val
                                      type: object
                                    type: array
                                  fraction:
                                    default: 1
                                    description: |-
                                      The fraction of spans to sample, in the range [0, 1].
                                      If the fraction is 0, no spans are sampled.
                                      If the fraction is 1, all spans are sampled.
                                    type: number
                                required:
                                - attributeConditions
                                - fraction
                                type: object
                              type: array
                            fallbackFraction:
                              default: 1
                              description: |-
                                Used as a fallback if all rules evaluate to false,
                                it may be empty - in this case the default value will be 1 - all spans are sampled.
                                it should be a float value in the range [0, 1] - the fraction of spans to sample.
                                a value of 0 means no spans are sampled if none of the rules evaluate to true.
                              type: number
                          required:
                          - fallbackFraction
                          type: object
                        headersCollection:
                          description: Configuration for headers collection. If not
                            specified, no headers will be collected.
                          properties:
                            httpHeaderKeys:
                              description: |-
                                Limit HTTP headers collection to specific header keys.
                                if unset, no HTTP headers will be collected.
                                HTTP headers cannot be collected as wildcard, to avoid leaking sensitive information.
                              items:
                                type: string
                              type: array
                          type: object
                        idGenerator:
                          description: |-
                            id generator configuration for the traces.
                            if not specified, the default random id generator will be used.
                          properties:
                            random:
                              description: |-
                                random id generator is the default, and most common.
                                it creates span ids and trace ids using random bytes.
                                It has no configuration.
                              type: object
                            timedWall:
                              description: |-
                                trace id includes timestamp, source id byte, and random number bytes.
                                this id generator can be leveraged by databases to do efficient indexing.
                              properties:
                                sourceId:
                                  description: |-
                                    sourceId is a number between 0-255 (8 bits) written into the 8th byte of the trace id.
                                    if timedWall is specified, the sourceId is required.
                                  type: integer
                              required:
                              - sourceId
                              type: object
                          type: object
                        spanRenamer:
                          description: Configuration for span renamer.
                          properties:
                            scopeRules:
                              description: |-
                                list of scope rules to be applied to the span name.
                                all options are always tried, regardless of whether the previous options have matched or not.
                              items:
                                properties:
                                  regexReplacements:
                                    description: |-
                                      list of regex replacements to be applied to the span name.
                                      all options are always tried, regardless of whether the previous options have matched or not.
                                    items:
                                      description: configuration for replacing parts
                                        of the span name with a template text based
                                        on regular expressions.
                                      properties:
                                        regexPattern:
                                          description: regualr expression that will
                                            be used to match the part of the span
                                            name to be replaced.
                                          type: string
                                        templateText:
                                          description: the text to be used for replacing
                                            the matched part of the span name.
                                          type: string
                                      required:
                                      - regexPattern
                                      - templateText
                                      type: object
                                    type: array
                                  scopeName:
                                    description: the name of the opentelemetry intrumentation
                                      scope which the renamed spans are written in.
                                    type: string
                                required:
                                - scopeName
                                type: object
                              type: array
                          type: object
                        urlTemplatization:
                          description: A list of URL templatization configurations
                            to be applied to the traces.
                          properties:
                            templatizationRules:
                              description: Rule is the template rule to be applied
                                to URLs
                              items:
                                type: string
                              type: array
                          type: object
                      type: object
                  required:
                  - agentEnabled
                  - containerName
                  type: object
                type: array
              containersOverrides:
                description: |-
                  will always list all containers of this workload by name,
                  and override data in case it is configured on the source.
                  this peoperty can be used to know all container names in the workload, even if other controllers did not yet run.
                items:
                  properties:
                    containerName:
                      description: The name of the container to override.
                      type: string
                    otelDistroName:
                      description: |-
                        select one specific otel distro to use for this container.
                        the selected distro must match the programming language and any constraints of the distro.
                        if the programmin language is incorrect, the runtime info can be overridden to match
                      type: string
                    runtimeInfo:
                      description: |-
                        RuntimeInfo to use for agent enabling.
                        If set for a container, the automatic detection will not be used for this container,
                        and the distro to use will be calculated based on this value.
                      properties:
                        containerName:
                          type: string
                        criErrorMessage:
                          description: |-
                            CriErrorMessage is set if the value in EnvFromContainerRuntime was not computed correctly and cannot be used safely.
                            Sometimes, even if CRI check failed, it is possible to tell that relevant env vars are not coming from container runtime.
                            Thus, this field is set only when there is:
                            - Actual CRI check failed
                            - The observed environment variables might come from container runtime
                          type: string
                        envFromContainerRuntime:
                          description: Holds the environment variables retrieved from
                            the container runtime.
                          items:
                            properties:
                              name:
                                type: string
                              value:
                                type: string
                            required:
                            - name
                            - value
                            type: object
                          type: array
                        envVars:
                          items:
                            properties:
                              name:
                                type: string
                              value:
                                type: string
                            required:
                            - name
                            - value
                            type: object
                          type: array
                        language:
                          enum:
                          - java
                          - python
                          - go
                          - dotnet
                          - javascript
                          - php
                          - ruby
                          - rust
                          - cplusplus
                          - mysql
                          - nginx
                          - redis
                          - postgres
                          - unknown
                          - ignored
                          type: string
                        libCType:
                          enum:
                          - glibc
                          - musl
                          type: string
                        otherAgent:
                          properties:
                            name:
                              type: string
                          type: object
                        runtimeUpdateState:
                          description: A temporary variable used during migration
                            to track whether the new runtime detection process has
                            been executed. If empty, it indicates the process has
                            not yet been run. This field may be removed later.
                          type: string
                        runtimeVersion:
                          type: string
                        secureExecutionMode:
                          description: |-
                            Indicates whether the target process is running is secure-execution mode.
                            nil means we were unable to determine the secure-execution mode.
                          type: boolean
                      required:
                      - containerName
                      - language
                      type: object
                  required:
                  - containerName
                  type: object
                type: array
              podManifestInjectionOptional:
                description: |-
                  true if all containers with agent injection enabled in this source
                  can be enabled without pod manifest changes.
                  if false, at least one container requires pod manifest changes to enable agent injection.
                type: boolean
              sdkConfigs:
                description: |-
                  Configuration for the OpenTelemetry SDKs that this workload should use.
                  The SDKs are identified by the programming language they are written in.
                items:
                  properties:
                    codeAttributes:
                      description: default configuration for collecting code attributes,
                        in case the instrumentation library does not provide a configuration.
                      properties:
                        column:
                          description: |-
                            Should record the `code.column` attribute.
                            if unset, the value will resolve from other relevant rules, or fallback to false
                          type: boolean
                        filePath:
                          description: |-
                            Should record the `code.filepath` attribute.
                            if unset, the value will resolve from other relevant rules, or fallback to false
                          type: boolean
                        function:
                          description: |-
                            Should record the `code.function` attribute.
                            if unset, the value will resolve from other relevant rules, or fallback to false
                          type: boolean
                        lineNumber:
                          description: |-
                            Should record the `code.lineno` attribute.
                            if unset, the value will resolve from other relevant rules, or fallback to false
                          type: boolean
                        namespace:
                          description: |-
                            Should record the `code.namespace` attribute.
                            if unset, the value will resolve from other relevant rules, or fallback to false
                          type: boolean
                        stackTrace:
                          description: |-
                            Should record the `code.stacktrace` attribute.
                            if unset, the value will resolve from other relevant rules, or fallback to false
                          type: boolean
                      type: object
                    customInstrumentations:
                      description: list of the custom instrumentation probes the SDK
                        should use.
                      properties:
                        golang:
                          items:
                            description: |-
                              golang custom probe contains the details for a custom probe for golang applications,
                              which includes the package name, function name or receiver name and method name to be instrumented.
                            properties:
                              functionName:
                                description: |-
                                  FunctionName is the name of the golang function to be instrumented, ie package name is "net/http" and the function
                                  name will be "ListenAndServe"; Function name is disallowed if ReceiverName and ReceiverMethodName are provided
                                type: string
                              packageName:
                                description: PackageName is the name of the golang
                                  pacakge (ie net/http); Package name is always required
                                type: string
                              receiverMethodName:
                                description: |-
                                  ReceiverMethodName is the name of the golang method, given a receiver struct, to be instrumented
                                  for example for "net/http" package, "response" is a receiver struct and "WriteHeader" is a method of that struct
                                  ReceiverMethodName is mandatory if ReceiverName is provided, and disallowed if FunctionName is provided
                                type: string
                              receiverName:
                                description: |-
                                  ReceiverName is the name of the golang receiver struct to be instrumented, ie for the "net/http" package, "response" is a receiver struct
                                  ReceiverName is disallowed if FunctionName is provided; Receiver must be a concrete type (not an interface)
                                type: string
                            required:
                            - packageName
                            type: object
                          type: array
                        java:
                          items:
                            description: |-
                              java custom probe contains the details for a custom probe for java applications,
                              which includes the class name and method name to be instrumented.
                            properties:
                              className:
                                type: string
                              methodName:
                                type: string
                            type: object
                          type: array
                      type: object
                    headSamplerConfig:
                      description: |-
                        HeadSamplingConfig is a set sampling rules.
                        This config currently only applies to root spans.
                        In the Future we might add another level of configuration base on the parent span (ParentBased Sampling)
                      properties:
                        attributesAndSamplerRules:
                          items:
                            description: |-
                              AttributesAndSamplerRule is a set of AttributeCondition that are ANDed together.
                              If all attribute conditions evaluate to true, the AND sampler evaluates to true,
                              and the fraction is used to determine the sampling decision.
                              If any of the attribute compare samplers evaluate to false,
                              the fraction is not used and the rule is skipped.
                              An "empty" AttributesAndSamplerRule with no attribute conditions is considered to always evaluate to true.
                              and the fraction is used to determine the sampling decision.
                              This entity is refered to a rule in Odigos terminology for head-sampling.
                            properties:
                              attributeConditions:
                                items:
                                  description: '''Operand'' represents the attributes
                                    and values that an operator acts upon in an expression'
                                  properties:
                                    key:
                                      description: attribute key (e.g. "url.path")
                                      type: string
                                    operator:
                                      description: The operator to use to compare
                                        the attribute value.
                                      enum:
                                      - equals
                                      - notEquals
                                      - endWith
                                      - startWith
                                      type: string
                                    val:
                                      description: currently only string values are
                                        supported.
                                      type: string
                                  required:
                                  - key
                                  - val
                                  type: object
                                type: array
                              fraction:
                                default: 1
                                description: |-
                                  The fraction of spans to sample, in the range [0, 1].
                                  If the fraction is 0, no spans are sampled.
                                  If the fraction is 1, all spans are sampled.
                                type: number
                            required:
                            - attributeConditions
                            - fraction
                            type: object
                          type: array
                        fallbackFraction:
                          default: 1
                          description: |-
                            Used as a fallback if all rules evaluate to false,
                            it may be empty - in this case the default value will be 1 - all spans are sampled.
                            it should be a float value in the range [0, 1] - the fraction of spans to sample.
                            a value of 0 means no spans are sampled if none of the rules evaluate to true.
                          type: number
                      required:
                      - fallbackFraction
                      type: object
                    headersCollection:
                      description: default configuration for collecting http headers,
                        in case the instrumentation library does not provide a configuration.
                      properties:
                        headerKeys:
                          description: Limit payload collection to specific header
                            keys.
                          items:
                            type: string
                          type: array
                      type: object
                    instrumentationLibraryConfigs:
                      description: configurations for the instrumentation libraries
                        the the SDK should use
                      items:
                        properties:
                          codeAttributes:
                            description: |-
                              code attributes configuration for a specific library.
                              if not set, the default code attributes configuration for the workload will be used.
                              if set, but internal fields are empty, those fields will be used from the default configuration.
                            properties:
                              column:
                                description: |-
                                  Should record the `code.column` attribute.
                                  if unset, the value will resolve from other relevant rules, or fallback to false
                                type: boolean
                              filePath:
                                description: |-
                                  Should record the `code.filepath` attribute.
                                  if unset, the value will resolve from other relevant rules, or fallback to false
                                type: boolean
                              function:
                                description: |-
                                  Should record the `code.function` attribute.
                                  if unset, the value will resolve from other relevant rules, or fallback to false
                                type: boolean
                              lineNumber:
                                description: |-
                                  Should record the `code.lineno` attribute.
                                  if unset, the value will resolve from other relevant rules, or fallback to false
                                type: boolean
                              namespace:
                                description: |-
                                  Should record the `code.namespace` attribute.
                                  if unset, the value will resolve from other relevant rules, or fallback to false
                                type: boolean
                              stackTrace:
                                description: |-
                                  Should record the `code.stacktrace` attribute.
                                  if unset, the value will resolve from other relevant rules, or fallback to false
                                type: boolean
                            type: object
                          headersCollection:
                            properties:
                              headerKeys:
                                description: Limit payload collection to specific
                                  header keys.
                                items:
                                  type: string
                                type: array
                            type: object
                          libraryId:
                            properties:
                              libraryName:
                                description: |-
                                  The name of the instrumentation library
                                  - Node.js: The name of the npm package: `@opentelemetry/instrumentation-<name>`
                                type: string
                              spanKind:
                                description: |-
                                  SpanKind is only supported by Golang and will be ignored for any other SDK language.
                                  In Go, SpanKind is used because the same instrumentation library can be utilized for different span kinds (e.g., client/server).
                                enum:
                                - client
                                - server
                                - producer
                                - consumer
                                - internal
                                type: string
                            required:
                            - libraryName
                            type: object
                          payloadCollection:
                            properties:
                              dbQuery:
                                description: rule for collecting db payloads for the
                                  mentioned workload and instrumentation libraries
                                properties:
                                  dropPartialPayloads:
                                    description: |-
                                      If the payload is larger than the MaxPayloadLength, this parameter will determine if the payload should be partially collected up to the allowed length, or not collected at all.
                                      This is useful if you require some decoding of the payload (like json) and having it partially is not useful.
                                    type: boolean
                                  maxPayloadLength:
                                    description: |-
                                      Maximum length of the payload to collect.
                                      If the payload is longer than this value, it will be truncated or dropped, based on the value of `dropPartialPayloads` config option
                                    format: int64
                                    type: integer
                                type: object
                              httpRequest:
                                description: |-
                                  Collect HTTP request payload data when available.
                                  Can be a client (outgoing) request or a server (incoming) request, depending on the instrumentation library
                                properties:
                                  dropPartialPayloads:
                                    description: |-
                                      If the payload is larger than the MaxPayloadLength, this parameter will determine if the payload should be partially collected up to the allowed length, or not collected at all.
                                      This is useful if you require some decoding of the payload (like json) and having it partially is not useful.
                                    type: boolean
                                  maxPayloadLength:
                                    description: |-
                                      Maximum length of the payload to collect.
                                      If the payload is longer than this value, it will be truncated or dropped, based on the value of `dropPartialPayloads` config option
                                    format: int64
                                    type: integer
                                  mimeTypes:
                                    description: |-
                                      Limit payload collection to specific mime types based on the content type header.
                                      When not specified, all mime types payloads will be collected.
                                      Empty array will make the rule ineffective.
                                    items:
                                      type: string
                                    type: array
                                type: object
                              httpResponse:
                                description: |-
                                  rule for collecting the response part of an http payload.
                                  Can be a client response or a server response, depending on the instrumentation library
                                properties:
                                  dropPartialPayloads:
                                    description: |-
                                      If the payload is larger than the MaxPayloadLength, this parameter will determine if the payload should be partially collected up to the allowed length, or not collected at all.
                                      This is useful if you require some decoding of the payload (like json) and having it partially is not useful.
                                    type: boolean
                                  maxPayloadLength:
                                    description: |-
                                      Maximum length of the payload to collect.
                                      If the payload is longer than this value, it will be truncated or dropped, based on the value of `dropPartialPayloads` config option
                                    format: int64
                                    type: integer
                                  mimeTypes:
                                    description: |-
                                      Limit payload collection to specific mime types based on the content type header.
                                      When not specified, all mime types payloads will be collected.
                                      Empty array will make the rule ineffective.
                                    items:
                                      type: string
                                    type: array
                                type: object
                              messaging:
                                description: rule for collecting messaging payloads
                                  for the mentioned workload and instrumentation libraries
                                properties:
                                  dropPartialPayloads:
                                    description: |-
                                      If the payload is larger than the MaxPayloadLength, this parameter will determine if the payload should be partially collected up to the allowed length, or not collected at all.
                                      This is useful if you require some decoding of the payload (like json) and having it partially is not useful.
                                    type: boolean
                                  maxPayloadLength:
                                    description: |-
                                      Maximum length of the payload to collect.
                                      If the payload is longer than this value, it will be truncated or dropped, based on the value of `dropPartialPayloads` config option
                                    format: int64
                                    type: integer
                                type: object
                            type: object
                          traceConfig:
                            properties:
                              enabled:
                                description: |-
                                  Whether the instrumentation library is enabled to record traces.
                                  When false, it is expected that the instrumentation library does not produce any spans regardless of any other configuration.
                                  When true, the instrumentation library should produce spans according to the other configuration options.
                                  If not specified, the default value for this signal should be used (whether to enable libraries by default or not).
                                type: boolean
                            type: object
                        required:
                        - libraryId
                        type: object
                      type: array
                    language:
                      description: The language of the SDK being configured
                      enum:
                      - java
                      - python
                      - go
                      - dotnet
                      - javascript
                      - php
                      - ruby
                      - rust
                      - cplusplus
                      - mysql
                      - nginx
                      - redis
                      - postgres
                      - unknown
                      - ignored
                      type: string
                    payloadCollection:
                      properties:
                        dbQuery:
                          description: rule for collecting db payloads for the mentioned
                            workload and instrumentation libraries
                          properties:
                            dropPartialPayloads:
                              description: |-
                                If the payload is larger than the MaxPayloadLength, this parameter will determine if the payload should be partially collected up to the allowed length, or not collected at all.
                                This is useful if you require some decoding of the payload (like json) and having it partially is not useful.
                              type: boolean
                            maxPayloadLength:
                              description: |-
                                Maximum length of the payload to collect.
                                If the payload is longer than this value, it will be truncated or dropped, based on the value of `dropPartialPayloads` config option
                              format: int64
                              type: integer
                          type: object
                        httpRequest:
                          description: |-
                            Collect HTTP request payload data when available.
                            Can be a client (outgoing) request or a server (incoming) request, depending on the instrumentation library
                          properties:
                            dropPartialPayloads:
                              description: |-
                                If the payload is larger than the MaxPayloadLength, this parameter will determine if the payload should be partially collected up to the allowed length, or not collected at all.
                                This is useful if you require some decoding of the payload (like json) and having it partially is not useful.
                              type: boolean
                            maxPayloadLength:
                              description: |-
                                Maximum length of the payload to collect.
                                If the payload is longer than this value, it will be truncated or dropped, based on the value of `dropPartialPayloads` config option
                              format: int64
                              type: integer
                            mimeTypes:
                              description: |-
                                Limit payload collection to specific mime types based on the content type header.
                                When not specified, all mime types payloads will be collected.
                                Empty array will make the rule ineffective.
                              items:
                                type: string
                              type: array
                          type: object
                        httpResponse:
                          description: |-
                            rule for collecting the response part of an http payload.
                            Can be a client response or a server response, depending on the instrumentation library
                          properties:
                            dropPartialPayloads:
                              description: |-
                                If the payload is larger than the MaxPayloadLength, this parameter will determine if the payload should be partially collected up to the allowed length, or not collected at all.
                                This is useful if you require some decoding of the payload (like json) and having it partially is not useful.
                              type: boolean
                            maxPayloadLength:
                              description: |-
                                Maximum length of the payload to collect.
                                If the payload is longer than this value, it will be truncated or dropped, based on the value of `dropPartialPayloads` config option
                              format: int64
                              type: integer
                            mimeTypes:
                              description: |-
                                Limit payload collection to specific mime types based on the content type header.
                                When not specified, all mime types payloads will be collected.
                                Empty array will make the rule ineffective.
                              items:
                                type: string
                              type: array
                          type: object
                        messaging:
                          description: rule for collecting messaging payloads for
                            the mentioned workload and instrumentation libraries
                          properties:
                            dropPartialPayloads:
                              description: |-
                                If the payload is larger than the MaxPayloadLength, this parameter will determine if the payload should be partially collected up to the allowed length, or not collected at all.
                                This is useful if you require some decoding of the payload (like json) and having it partially is not useful.
                              type: boolean
                            maxPayloadLength:
                              description: |-
                                Maximum length of the payload to collect.
                                If the payload is longer than this value, it will be truncated or dropped, based on the value of `dropPartialPayloads` config option
                              format: int64
                              type: integer
                          type: object
                      type: object
                    runtimeMetrics:
                      description: |-
                        configuration for runtime metrics that the SDK should generate.
                        these are language-specific metrics like JVM metrics for Java, CLR metrics for .NET, etc.
                      properties:
                        java:
                          description: configuration for Java runtime metrics
                          properties:
                            disabled:
                              description: global enable/disable for all Java runtime
                                metrics
                              type: boolean
                            metrics:
                              description: individual metric configurations
                              items:
                                properties:
                                  disabled:
                                    description: whether this specific metric is disabled
                                    type: boolean
                                  name:
                                    description: name of the runtime metric (e.g.,
                                      "jvm.class.loaded")
                                    type: string
                                required:
                                - name
                                type: object
                              type: array
                          type: object
                      type: object
                    traceConfig:
                      description: default configuration for library tracing.
                      properties:
                        disabled:
                          description: Disabled will disable tracing for the rule.
                          type: boolean
                      type: object
                  required:
                  - language
                  type: object
                type: array
              serviceName:
                description: the service.name property is used to populate the `service.name`
                  resource attribute in the telemetry generated by this workload
                type: string
              workloadCollectorConfig:
                items:
                  description: ContainerCollectorConfig is a configuration for a specific
                    container in a workload.
                  properties:
                    containerName:
                      description: The name of the container to which this configuration
                        applies.
                      type: string
                    samplingCollectorConfig:
                      description: The sampling configuration that relevant for the
                        collector (tailsampling).
                      properties:
                        costReductionRules:
                          items:
                            properties:
                              notes:
                                description: |-
                                  optional free-form text field that allows you to attach notes
                                  for future context and maintenance.
                                  users can write why this rule was added, observations, document considerations, etc.
                                type: string
                              operation:
                                description: |-
                                  limit this rule to specific operations.
                                  for example: specific endpoint or kafka topic.
                                  this field is optional, and if not set, the rule will be applied to all operations.
                                properties:
                                  httpServer:
                                    description: match http server operations in a
                                      generic way.
                                    properties:
                                      method:
                                        description: optionally limit to specific
                                          http method
                                        type: string
                                      route:
                                        description: a specific exact match http route
                                        type: string
                                      routePrefix:
                                        description: any route that starts with a
                                          specific prefix
                                        type: string
                                    type: object
                                  kafkaConsumer:
                                    description: match kafka consumer operations (consume
                                      spans)
                                    properties:
                                      kafkaTopic:
                                        description: |-
                                          the topic name to match.
                                          if left empty, all topics are matched.
                                        type: string
                                    type: object
                                  kafkaProducer:
                                    description: match kafka producer operations (produce
                                      spans)
                                    properties:
                                      kafkaTopic:
                                        description: |-
                                          the topic name to match.
                                          if left empty, all topics are matched.
                                        type: string
                                    type: object
                                type: object
                              percentageAtMost:
                                description: |-
                                  sampling percentage for cost reduction.
                                  this field is required.
                                  the final sampling percentage for traces that match this rule
                                  will be the highest possible, but at most this value.
                                maximum: 100
                                minimum: 0
                                type: number
                              sourceScopes:
                                description: |-
                                  limit this rule to specific sources (by name, namespace, language, etc.)
                                  an empty list will match any source.
                                  if multiple items are set, the operation match if any one matches
                                  this relates to the "ResourceAttributes" part of a span.
                                items:
                                  description: |-
                                    define conditions to match specific sources (containers) managed by odigos.
                                    a source container matches, if ALL non empty fields match (AND semantics)

                                    common patterns:
                                    - Specific kubernetes workload by name (WorkloadNamespace + WorkloadKind + WorkloadName) - all containers (usually there is only one with agent injection)
                                    - Specific container in a kubernetes workload (WorkloadNamespace + WorkloadKind + WorkloadName + ContainerName) - only this container
                                    - All services in a kubernetes namespace (WorkloadNamespace) - all containers in all sources in the namespace
                                    - All services implemented in a specific programming language (WorkloadLanguage) - all container which are running odigos agent for this language
                                  properties:
                                    containerName:
                                      type: string
                                    workloadKind:
                                      description: |-
                                        1. the pascal case representation of the workload kind
                                        it is used in k8s api objects as the `Kind` field.
                                      type: string
                                    workloadLanguage:
                                      enum:
                                      - java
                                      - python
                                      - go
                                      - dotnet
                                      - javascript
                                      - php
                                      - ruby
                                      - rust
                                      - cplusplus
                                      - mysql
                                      - nginx
                                      - redis
                                      - postgres
                                      - unknown
                                      - ignored
                                      type: string
                                    workloadName:
                                      type: string
                                    workloadNamespace:
                                      type: string
                                  type: object
                                type: array
                            required:
                            - percentageAtMost
                            type: object
                          type: array
                        highlyRelevantOperations:
                          items:
                            description: |-
                              define operations (spans) with high observability value.
                              if found anywhere in the trace, the entire trace will be kept
                              regaradless of any cost reduction rules.
                            properties:
                              durationAtLeastMs:
                                description: if Duration is set, only operations with
                                  duration in milli seconds larger then this value
                                  are considered
                                type: integer
                              error:
                                description: if "Error" is set to true, only spans
                                  with SpanStatus set to "Error" are considered
                                type: boolean
                              notes:
                                description: |-
                                  optional free-form text field that allows you to attach notes
                                  for future context and maintenance.
                                  users can write why this rule was added, observations, document considerations, etc.
                                type: string
                              operation:
                                description: |-
                                  optionally, limit this rule to specific operations.
                                  for example: specific endpoint or kafka topic.
                                  this field is optional, and if not set, the rule will be applied to all operations.
                                properties:
                                  httpServer:
                                    description: match http server operations in a
                                      generic way.
                                    properties:
                                      method:
                                        description: optionally limit to specific
                                          http method
                                        type: string
                                      route:
                                        description: a specific exact match http route
                                        type: string
                                      routePrefix:
                                        description: any route that starts with a
                                          specific prefix
                                        type: string
                                    type: object
                                  kafkaConsumer:
                                    description: match kafka consumer operations (consume
                                      spans)
                                    properties:
                                      kafkaTopic:
                                        description: |-
                                          the topic name to match.
                                          if left empty, all topics are matched.
                                        type: string
                                    type: object
                                  kafkaProducer:
                                    description: match kafka producer operations (produce
                                      spans)
                                    properties:
                                      kafkaTopic:
                                        description: |-
                                          the topic name to match.
                                          if left empty, all topics are matched.
                                        type: string
                                    type: object
                                type: object
                              percentageAtLeast:
                                description: |-
                                  traces that contains this operation will be sampled by at least this percentage.
                                  if unset, 100% of such the traces will be sampled.
                                maximum: 100
                                minimum: 0
                                type: number
                              sourceScopes:
                                description: |-
                                  limit the operation to specific sources.
                                  an empty list will match any source.
                                  if multiple items are set, the operation match if any one matches
                                  this relates to the "ResourceAttributes" part of a span.
                                items:
                                  description: |-
                                    define conditions to match specific sources (containers) managed by odigos.
                                    a source container matches, if ALL non empty fields match (AND semantics)

                                    common patterns:
                                    - Specific kubernetes workload by name (WorkloadNamespace + WorkloadKind + WorkloadName) - all containers (usually there is only one with agent injection)
                                    - Specific container in a kubernetes workload (WorkloadNamespace + WorkloadKind + WorkloadName + ContainerName) - only this container
                                    - All services in a kubernetes namespace (WorkloadNamespace) - all containers in all sources in the namespace
                                    - All services implemented in a specific programming language (WorkloadLanguage) - all container which are running odigos agent for this language
                                  properties:
                                    containerName:
                                      type: string
                                    workloadKind:
                                      description: |-
                                        1. the pascal case representation of the workload kind
                                        it is used in k8s api objects as the `Kind` field.
                                      type: string
                                    workloadLanguage:
                                      enum:
                                      - java
                                      - python
                                      - go
                                      - dotnet
                                      - javascript
                                      - php
                                      - ruby
                                      - rust
                                      - cplusplus
                                      - mysql
                                      - nginx
                                      - redis
                                      - postgres
                                      - unknown
                                      - ignored
                                      type: string
                                    workloadName:
                                      type: string
                                    workloadNamespace:
                                      type: string
                                  type: object
                                type: array
                            type: object
                          type: array
                        noisyOperations:
                          items:
                            description: |-
                              endpoints which are considered "noise", and provide no or very little observability value.
                              these traces should not be collected at all, or dropped aggresevly.
                              motivation is data sentization and performance improvment (even if cost is not a factor)

                              examples:
                              - health-checks (readiness and liveness probes)
                              - metrics scrape endpoints (promethues /metrics endpoint)
                              - other agents calling home (outgoing http requests to collector.my.vendor.com)
                            properties:
                              notes:
                                description: |-
                                  optional free-form text field that allows you to attach notes
                                  for future context and maintenance.
                                  users can write why this rule was added, observations, document considerations, etc.
                                type: string
                              operation:
                                description: |-
                                  limit this rule to specific operations.
                                  for example: specific http server endpoint (GET "/healthz" as an example).
                                  this field is optional, and if not set, the rule will be applied to all operations.
                                properties:
                                  httpClient:
                                    description: |-
                                      match http client operation (trace that starts with an http client operation)
                                      common for agents that are internally calling home over http, and exporting data.
                                    properties:
                                      method:
                                        description: match method exactly, can be
                                          empty to match any method
                                        type: string
                                      serverAddress:
                                        description: match server address exactly
                                          (e.g. collector.my.vendor.com)
                                        type: string
                                      urlPath:
                                        description: match url path exactly (e.g.
                                          /api/v1/metrics)
                                        type: string
                                    type: object
                                  httpServer:
                                    description: match http server operation (trace
                                      that starts with an http endpoint)
                                    properties:
                                      method:
                                        description: match method exactly, can be
                                          empty to match any method
                                        type: string
                                      route:
                                        description: match route exactly
                                        type: string
                                      routePrefix:
                                        description: match preffix of route
                                        type: string
                                    type: object
                                type: object
                              percentageAtMost:
                                description: |-
                                  sampling percentage for noisy operations.
                                  if unset, 0% of such the traces will be collected.
                                  this percentage has "at most" semantics - the final sampling percentage for traces that match this rule
                                  will be the highest possible, but at most this value.
                                maximum: 100
                                minimum: 0
                                type: number
                              sourceScopes:
                                description: |-
                                  limit this rule to specific sources (by name, namespace, language, etc.)
                                  for example: if "other agent" rule for noisty operation is relevant only in java,
                                  limit this rule by setting source scope to java and prevent other languages from being affected
                                  if the list is empty - all sources are matched.
                                items:
                                  description: |-
                                    define conditions to match specific sources (containers) managed by odigos.
                                    a source container matches, if ALL non empty fields match (AND semantics)

                                    common patterns:
                                    - Specific kubernetes workload by name (WorkloadNamespace + WorkloadKind + WorkloadName) - all containers (usually there is only one with agent injection)
                                    - Specific container in a kubernetes workload (WorkloadNamespace + WorkloadKind + WorkloadName + ContainerName) - only this container
                                    - All services in a kubernetes namespace (WorkloadNamespace) - all containers in all sources in the namespace
                                    - All services implemented in a specific programming language (WorkloadLanguage) - all container which are running odigos agent for this language
                                  properties:
                                    containerName:
                                      type: string
                                    workloadKind:
                                      description: |-
                                        1. the pascal case representation of the workload kind
                                        it is used in k8s api objects as the `Kind` field.
                                      type: string
                                    workloadLanguage:
                                      enum:
                                      - java
                                      - python
                                      - go
                                      - dotnet
                                      - javascript
                                      - php
                                      - ruby
                                      - rust
                                      - cplusplus
                                      - mysql
                                      - nginx
                                      - redis
                                      - postgres
                                      - unknown
                                      - ignored
                                      type: string
                                    workloadName:
                                      type: string
                                    workloadNamespace:
                                      type: string
                                  type: object
                                type: array
                            type: object
                          type: array
                      type: object
                  required:
                  - containerName
                  type: object
                type: array
            required:
            - agentInjectionEnabled
            type: object
          status:
            properties:
              conditions:
                description: Represents the observations of a InstrumentationConfig's
                  current state.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              instrumentationTime:
                description: |-
                  This time recorded only after the rollout took place.
                  This allows us to determine whether a crashing application should be rolled back or not
                format: date-time
                type: string
              podsManifestInjectionStatus:
                description: Represents the status of odigos MANIFEST injection to
                  existing pods template.
                properties:
                  hasInjectedOutOfDatePods:
                    description: if the source has any pods which are using an outdated
                      agent deployment setup.
                    type: boolean
                  hasInjectedUpToDatePods:
                    description: if the source has any pods which are using the latest
                      agent deployment setup.
                    type: boolean
                  hasUninjectedPods:
                    description: if the source has any pods which do not have the
                      odigos agent injected.
                    type: boolean
                type: object
              rollbackOccurred:
                description: Check if rollback happened to an application
                type: boolean
              runtimeDetailsByContainer:
                description: Capture Runtime Details for the workloads that this CR
                  applies to.
                items:
                  properties:
                    containerName:
                      type: string
                    criErrorMessage:
                      description: |-
                        CriErrorMessage is set if the value in EnvFromContainerRuntime was not computed correctly and cannot be used safely.
                        Sometimes, even if CRI check failed, it is possible to tell that relevant env vars are not coming from container runtime.
                        Thus, this field is set only when there is:
                        - Actual CRI check failed
                        - The observed environment variables might come from container runtime
                      type: string
                    envFromContainerRuntime:
                      description: Holds the environment variables retrieved from
                        the container runtime.
                      items:
                        properties:
                          name:
                            type: string
                          value:
                            type: string
                        required:
                        - name
                        - value
                        type: object
                      type: array
                    envVars:
                      items:
                        properties:
                          name:
                            type: string
                          value:
                            type: string
                        required:
                        - name
                        - value
                        type: object
                      type: array
                    language:
                      enum:
                      - java
                      - python
                      - go
                      - dotnet
                      - javascript
                      - php
                      - ruby
                      - rust
                      - cplusplus
                      - mysql
                      - nginx
                      - redis
                      - postgres
                      - unknown
                      - ignored
                      type: string
                    libCType:
                      enum:
                      - glibc
                      - musl
                      type: string
                    otherAgent:
                      properties:
                        name:
                          type: string
                      type: object
                    runtimeUpdateState:
                      description: A temporary variable used during migration to track
                        whether the new runtime detection process has been executed.
                        If empty, it indicates the process has not yet been run. This
                        field may be removed later.
                      type: string
                    runtimeVersion:
                      type: string
                    secureExecutionMode:
                      description: |-
                        Indicates whether the target process is running is secure-execution mode.
                        nil means we were unable to determine the secure-execution mode.
                      type: boolean
                  required:
                  - containerName
                  - language
                  type: object
                type: array
              workloadRolloutHash:
                description: |-
                  This hash is recorded only after the rollout took place.
                  it allows us to determine if the workload needs to be rollout based on previous rollout and the current config.
                  if this field is different than the spec.AgentsDeploymentHash it means rollout is needed or not yet updated.
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
