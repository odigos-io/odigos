apiVersion: internal.odigos.io/v1beta1
kind: OtelDistribution
metadata:
  name: php-community
spec:
  name: php-community
  language: php
  runtimeEnvironments:
    - name: php
      supportedVersions: '>=8.1 <8.2'
  displayName: 'PHP Community Native Instrumentation'
  description: |
    This distribution is for PHP applications using OpenTelemetry Native SDK and instrumentation libraries from the OpenTelemetry community.
  environmentVariables:
    otlpHttpLocalNode: true
    staticVariables:
      # How to use PHP_INI_SCAN_DIR env with colon (:) separator...
      # Assuming /etc/php.d/*.ini is the default configuration file;
      #
      # RUN php
      # will load all files in /etc/php.d/*.ini (default)
      #
      # RUN PHP_INI_SCAN_DIR=/usr/local/etc/php.d php
      # will load all files in /usr/local/etc/php.d/*.ini (custom),
      # and ignore /etc/php.d/*.ini (default)
      #
      # RUN PHP_INI_SCAN_DIR=:/usr/local/etc/php.d php
      # will 1st load all files in /etc/php.d/*.ini (default),
      # then load /usr/local/etc/php.d/*.ini (custom)
      #
      # RUN PHP_INI_SCAN_DIR=/usr/local/etc/php.d: php
      # will 1st load all files in /usr/local/etc/php.d/*.ini (custom),
      # then load /etc/php.d/*.ini (default)
      - envName: PHP_INI_SCAN_DIR
        # TODO: add support for dynamic PHP versions
        envValue: '/var/odigos/php/8.1:'
      - envName: OTEL_PHP_AUTOLOAD_ENABLED
        envValue: true
  runtimeAgent:
    directoryNames:
      - '{{ODIGOS_AGENTS_DIR}}/php'
    device: 'instrumentation.odigos.io/generic'
    k8sAttrsViaEnvVars: true
