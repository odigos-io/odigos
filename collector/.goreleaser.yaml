version: 2
project_name: odigos-otelcol

before:
  hooks:
    - go mod tidy -C odigosotelcol

builds:
  - id: odigos-otelcol-linux
    env: [CGO_ENABLED=0]
    dir: odigosotelcol
    main: .
    binary: odigos-otelcol
    goos: [linux]
    goarch: [amd64, arm64]
    flags: [-trimpath]
    ldflags:
      - -s -w -checklinkname=0

nfpms:
  - id: packages # this id is used in the publisher section to specify which artifacts to publish
    package_name: odigos-otelcol
    vendor: Odigos Inc.
    maintainer: Odigos Inc.
    homepage: https://odigos.io
    description: Instant distributed tracing without code changes using eBPF
    formats:
      - deb
      - rpm
    file_name_template: "{{ .ConventionalFileName }}"
    contents:
      - src: distribution/odigos-otelcol/odigos-otelcol.service
        dst: /lib/systemd/system/odigos-otelcol.service
      - src: distribution/odigos-otelcol/odigos-otelcol.conf
        dst: /etc/odigos-otelcol/odigos-otelcol.conf
        type: config|noreplace
      - src: distribution/odigos-otelcol/config.yaml
        dst: /etc/odigos-otelcol/config.yaml
        type: config|noreplace
    scripts:
      preinstall: distribution/odigos-otelcol/preinstall.sh
      postinstall: distribution/odigos-otelcol/postinstall.sh
      preremove: distribution/odigos-otelcol/preremove.sh
# we don't need the otelcol to have releases in github.
# this goreleaser is only about publishing the collector as deb/rpm package to the google repository
release:
  disable: true
