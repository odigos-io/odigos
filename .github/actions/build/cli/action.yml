name: "Build Odigos CLI"
description: "Build odigos CLI binary"
runs:
  using: "composite"
  steps:
    - name: Build
      shell: bash
      run: |
        cd cli
        TAG=0.0.0-e2e-test
        sed -i -E 's/0.0.0/'"${TAG#v}"'/' ../helm/odigos/Chart.yaml
        helm package ../helm/odigos -d pkg/helm/embedded
        go build -tags=embed_manifests \
          -ldflags "-X github.com/odigos-io/odigos/cli/pkg/helm.OdigosChartVersion=${TAG#v}" \
          -o odigos
