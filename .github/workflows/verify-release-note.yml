name: Release Note Check

on:
  pull_request:
    types: [opened, edited, synchronize, labeled, unlabeled]

jobs:
  release-note:
    runs-on: ubuntu-latest
    if: ${{ !contains(github.event.pull_request.labels.*.name, 'prerelease') }}
    steps:
      - name: Check release note block
        env:
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          echo "$PR_BODY" > pr_body.txt
          
          if ! grep -q '^```release-note' pr_body.txt; then
            echo "❌ Missing \`\`\`release-note block"
            exit 1
          fi

          # Extract content between fenced blocks
          CONTENT=$(awk '
            /^```release-note/ {flag=1; next}
            /^```/ {flag=0}
            flag {print}
          ' pr_body.txt)

          # Block must contain at least one non-whitespace character
          if ! echo "$CONTENT" | grep -q '[^[:space:]]'; then
            echo "❌ release-note block is empty"
            exit 1
          fi

          echo "✅ Release note present"
